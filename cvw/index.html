<html>
    <head>
        <title>CVW-69 GCI</title>
        <link
            rel="stylesheet"
            href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"
        />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script src="js/icons.js"></script>
        <style>
            #map {
                height: 100%;
            }
        </style>
    </head>
    <body onload="fetchJSON()">
        <div id="map"></div>

        <script>
            var targets = L.layerGroup();
            var airports = L.layerGroup();
            // initialize the map
            var map = L.map("map", {
                layers: [targets, airports]
            }).setView([26, 56.26], 8);

            // load a tile layer

            L.tileLayer(
                "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",
                {
                    attribution:
                        'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                    maxZoom: 100,
                    id: "mapbox.dark",
                    accessToken:
                        "pk.eyJ1IjoibGxhbWExNDEyIiwiYSI6ImNqbzRjczZvZjEzOGIzcW1vcG5kcWh1cHAifQ.DHfYxSbxL-CVRZF1Cqhuaw"
                }
            ).addTo(map);
        </script>

        <script>
            function fetchJSON() {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        myObj = JSON.parse(this.responseText);
                        addAirports(myObj);
                        //beginLoad(myObj);
                        return myObj;
                    }
                };
                xmlhttp.open("GET", "http://dcs.cvw-69.com", true);
                xmlhttp.send();
            }

            function addAirports(jsonobject) {
                for (var i = 0; i < jsonobject.airports.length; i++) {
                    if (jsonobject.airports[i].Name !== "woRunWay") {
                        if (jsonobject.airports[i].Coalition == "Allies") {
                            var marker = L.marker(
                                [
                                    jsonobject.airports[i].LatLongAlt.Lat,
                                    jsonobject.airports[i].LatLongAlt.Long
                                ],
                                {
                                    icon: airportredico
                                }
                            )
                                .bindPopup(
                                    "<b>" +
                                        jsonobject.airports[i].Name +
                                        "</b>"
                                )
                                .addTo(airports);
                        } else if (
                            jsonobject.airports[i].Coalition == "Enemies"
                        ) {
                            var marker = L.marker(
                                [
                                    jsonobject.airports[i].LatLongAlt.Lat,
                                    jsonobject.airports[i].LatLongAlt.Long
                                ],
                                {
                                    icon: airportblueico
                                }
                            )
                                .bindPopup(
                                    "<b>" +
                                        jsonobject.airports[i].Name +
                                        "</b>"
                                )
                                .addTo(airports);
                        } else {
                            var marker = L.marker(
                                [
                                    jsonobject.airports[i].LatLongAlt.Lat,
                                    jsonobject.airports[i].LatLongAlt.Long
                                ],
                                {
                                    icon: airportico
                                }
                            )
                                .bindPopup(
                                    "<b>" +
                                        jsonobject.airports[i].Name +
                                        "</b>"
                                )
                                .addTo(airports);
                        }
                    }
                }
            }
        </script>
    </body>
</html>
