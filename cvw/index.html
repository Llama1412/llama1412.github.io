<html>
    <head>
        <title>CVW-69 GCI</title>
        <link
            rel="stylesheet"
            href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"
        />
        <link rel="stylesheet" href="css\myStyle.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script src="js/icons.js"></script>
        <style>
            #map {
                height: 100%;
            }
        </style>
    </head>
    <body onload="fetchJSON()">
        <div id="map"></div>

        <script>
            var targets = L.layerGroup();
            var airports = L.layerGroup();
            // initialize the map
            var map = L.map("map", {
                layers: [targets, airports]
            }).setView([26, 56.26], 8);

            // load a tile layer

            L.tileLayer(
                "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",
                {
                    attribution:
                        'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                    maxZoom: 100,
                    id: "mapbox.dark",
                    accessToken:
                        "pk.eyJ1IjoibGxhbWExNDEyIiwiYSI6ImNqbzRjczZvZjEzOGIzcW1vcG5kcWh1cHAifQ.DHfYxSbxL-CVRZF1Cqhuaw"
                }
            ).addTo(map);
        </script>

        <script>
            function toDecimal(number) {
                var deg = Math.floor(number).toString();
                var minutes = ((number - deg) * 60).toFixed(3);

                if (deg.length < 2) {
                    deg = "0" + deg;
                }

                if (minutes.length < 6) {
                    minutes = "0" + minutes;
                }

                return deg + "°" + minutes;
            }

            function toSec(number) {
                var deg = Math.floor(number).toString();
                var mins = Math.floor((number-deg)*60).toString();
                var seconds = ((((number-deg)*60) - Math.floor((number-deg)*60))*60).toFixed(0);

                if (deg.length < 2) {
                    deg = "0" + deg;
                }
                if (mins.length < 2) {
                    mins = "0" + mins;
                }
                if (seconds.length < 2) {
                    seconds = "0" + seconds;
                }

                return deg + "°" + mins + "\'" + seconds + "\"";
            }

            function fetchJSON() {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        myObj = JSON.parse(this.responseText);
                        addAirports(myObj);
                        //beginLoad(myObj);
                        return myObj;
                    }
                };
                xmlhttp.open("GET", "http://dcs.cvw-69.com", true);
                xmlhttp.send();
            }

            function addAirports(jsonobject) {
                for (var i = 0; i < jsonobject.airports.length; i++) {
                    if (jsonobject.airports[i].Name !== "woRunWay") {
                        if (jsonobject.airports[i].Coalition == "Allies") {
                            var marker = L.marker(
                                [
                                    jsonobject.airports[i].LatLongAlt.Lat,
                                    jsonobject.airports[i].LatLongAlt.Long
                                ],
                                {
                                    icon: airportredico
                                }
                            ) // toDecimal(jsonobject.airports[i].LatLongAlt.Lat)
                                .bindPopup(
                                    "<h3>" +
                                        jsonobject.airports[i].Name +
                                        "</h3>" +
                                        "<table>" +
                                        "<tr><th></th><th>North</th><th>East</th></tr>" +
                                        "<tr><td>DEC</td>" +
                                        "<td>" +
                                        toDecimal(
                                            jsonobject.airports[i].LatLongAlt
                                                .Lat
                                        ) +
                                        "</td>" +
                                        "<td>" +
                                        toDecimal(
                                            jsonobject.airports[i].LatLongAlt
                                                .Long
                                        ) +
                                        "</td>" +
                                        "<tr><td>SEC</td>" +
                                        "<td>" +
                                        toSec(
                                            jsonobject.airports[i].LatLongAlt
                                                .Lat
                                        ) +
                                        "</td>" +
                                        "<td>" +
                                        toSec(
                                            jsonobject.airports[i].LatLongAlt
                                                .Long
                                        ) +
                                        "</td>" +
                                        "</tr>" +
                                        "</table>"
                                )
                                .addTo(airports);
                        } else if (
                            jsonobject.airports[i].Coalition == "Enemies"
                        ) {
                            var marker = L.marker(
                                [
                                    jsonobject.airports[i].LatLongAlt.Lat,
                                    jsonobject.airports[i].LatLongAlt.Long
                                ],
                                {
                                    icon: airportblueico
                                }
                            )
                                .bindPopup(
                                    "<b>" + jsonobject.airports[i].Name + "</b>"
                                )
                                .addTo(airports);
                        } else {
                            var marker = L.marker(
                                [
                                    jsonobject.airports[i].LatLongAlt.Lat,
                                    jsonobject.airports[i].LatLongAlt.Long
                                ],
                                {
                                    icon: airportico
                                }
                            )
                                .bindPopup(
                                    "<b>" + jsonobject.airports[i].Name + "</b>"
                                )
                                .addTo(airports);
                        }
                    }
                }
            }
        </script>
    </body>
</html>
