<html>

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="icons.js"></script>
</head>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Viggen Cartridge Builder</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <button id="clearButton" type="button" class="btn btn-primary" onclick="clearAll()">Clear</button>
            </li>
            <li class="nav-item">
                <button id="exportButton" type="button" class="btn btn-primary" onclick="download(dataArray.join('\n'))">Export</button>
            </li>
        </ul>
    </div>
</nav>




<div id="mapid" style="height: 90%;">
    <script>
        var waypoints = L.layerGroup();
        var dataArrayBackup = ["cartridgename = Llamas Cartridge Builder\n"];
        var dataArray = ["cartridgename = Llamas Cartridge Builder\n"];
        var counter = 1;
        var lastcoords = [];

        function download(data) {
            a = document.createElement("a")
            a.href = "data:text/plain," + encodeURIComponent(data);
            a.download = "CustomCartridge.ini";
            a.click();
        };

        var mymap = L.map('mapid', {
            layers: [waypoints]
        }).setView([45.003105, 37.34828], 13);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoibGxhbWExNDEyIiwiYSI6ImNqbzRjczZvZjEzOGIzcW1vcG5kcWh1cHAifQ.DHfYxSbxL-CVRZF1Cqhuaw'
        }).addTo(mymap);

        function onMapClick(e) {
            if (counter <= 8) {
                if (counter == 1) {
                    var marker = L.marker(e.latlng, {icon: B1})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 2) {
                    var marker = L.marker(e.latlng, {icon: B2})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 3) {
                    var marker = L.marker(e.latlng, {icon: B3})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 2) {
                    var marker = L.marker(e.latlng, {icon: B3})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 4) {
                    var marker = L.marker(e.latlng, {icon: B4})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 5) {
                    var marker = L.marker(e.latlng, {icon: B5})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 6) {
                    var marker = L.marker(e.latlng, {icon: B6})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 7) {
                    var marker = L.marker(e.latlng, {icon: B7})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                } else if (counter == 8) {
                    var marker = L.marker(e.latlng, {icon: B8})
                    .bindPopup("<b>Waypoint </b> B" + counter.toString() + " <b>at</b> " + e.latlng)
                    .addTo(waypoints);
                }






                if (lastcoords.length == 2) {
                    lastcoords.shift()
                };
                if (lastcoords.length != 0) {
                    lastcoords.push(e.latlng);
                    var firstpolyline = new L.Polyline(lastcoords, {
                        color: 'red',
                        weight: 3,
                        opacity: 0.5,
                        smoothFactor: 1
                    });
                    firstpolyline.addTo(waypoints);
                } else {
                    lastcoords.push(e.latlng);
                };
                dataArray.push("[B" + counter.toString() + "]"); //ID
                dataArray.push("latitude = " + e.latlng.lat.toString()); //lat
                dataArray.push("latitudeminutes = 0"); //latmin
                dataArray.push("latitudeseconds = 0"); //latsec
                dataArray.push("longitude = " + e.latlng.lng.toString()); //long
                dataArray.push("longitudeminutes = 0"); //longmin
                dataArray.push("longitudeseconds = 0"); //longsec
                dataArray.push("missiontime = 0"); //mistime
                dataArray.push("velocity = 0"); //velocity
                dataArray.push("etalocked = false"); //etalock
                dataArray.push("velocitylocked = false"); //vellock
                dataArray.push("istargetpoint = false"); //target?
                dataArray.push(""); //newline

                counter = counter + 1;
            } else {
                alert("Max limit reached!");
            };
        };

        function clearAll(e) {
            waypoints.clearLayers();
            dataArray = dataArrayBackup;
            lastcoords = [];
            counter = 1;
        };

        mymap.on('click', onMapClick);
    </script>


</div>

</html>